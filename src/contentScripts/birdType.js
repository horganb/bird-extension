export const birdTypes = [
  {
    name: 'American Crow',
    species: 'Corvus brachyrhynchos',
    imagePath: 'americanCrow',
    speed: 0.25,
    rarity: 1,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [85, 100],
    mass: [316, 620],
    fact: 'The American crow thrives around people, often spotted in agricultural fields, lawns, parking lots, athletic fields, roadsides, towns, and city garbage dumps.',
  },
  {
    name: 'American Goldfinch',
    species: 'Spinus tristis',
    imagePath: 'americanGoldfinch',
    speed: 0.25,
    rarity: 2,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [19, 22],
    mass: [11, 20],
    fact: 'As one of the strictest vegetarians in the bird world, the American goldfinch feeds on a wide variety of seeds, including those of dandelion, teasel, and goatsbeard.',
  },
  {
    name: 'American Robin',
    species: 'Turdus migratorius',
    imagePath: 'americanRobin',
    speed: 0.3,
    rarity: 1,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [31, 41],
    mass: [72, 94],
    fact: 'The American robin is the most abundant bird in North America, with 370,000,000 estimated individuals.',
  },
  {
    name: "Anna's Hummingbird",
    species: 'Calypte anna',
    imagePath: 'annasHummingbird',
    speed: 0.35,
    rarity: 4,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [4.7],
    mass: [2.8, 5.7],
    fact: "The Anna's hummingbird can shake its body 55 times per second to shed rain or remove pollen or dirt from feathers.",
  },
  {
    name: 'Baltimore Oriole',
    species: 'Icterus galbula',
    imagePath: 'baltimoreOriole',
    speed: 0.3,
    rarity: 2,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [23, 32],
    mass: [22.3, 42],
    fact: 'With a strong preference for dark-colored fruits, orioles will ignore green grapes and yellow cherries even if they are ripe.',
  },
  {
    name: 'Barn Owl',
    species: 'Tyto alba',
    imagePath: 'barnOwl',
    speed: 0.25,
    rarity: 2,
    region: 'Widespread',
    habitat: 'Forests',
    wingspan: [80, 95],
    mass: [260, 555],
    fact: 'As the most widespread of all landbird species, the barn owl is found on every continent except Antarctica.',
    nocturnal: true,
  },
  {
    name: 'Bee Hummingbird',
    species: 'Mellisuga helenae',
    imagePath: 'beeHummingbird',
    speed: 0.3,
    rarity: 6,
    region: 'Caribbean',
    habitat: 'Rainforests',
    wingspan: [3.25],
    mass: [1.95],
    fact: "As the smallest species of bird, the bee hummingbird's iridescence gives it the appearance of a tiny jewel.",
  },
  {
    name: 'Black-billed Magpie',
    species: 'Pica hudsonia',
    imagePath: 'blackbilledMagpie',
    speed: 0.3,
    rarity: 2,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [20.5, 21.9],
    mass: [167, 216],
    fact: 'The black-billed Magpie frequently picks ticks from the backs of large mammals, such as deer and moose.',
  },
  {
    name: 'Blue Jay',
    species: 'Cyanocitta cristata',
    imagePath: 'blueJay',
    speed: 0.3,
    rarity: 2,
    region: 'N. America',
    habitat: 'Forests',
    wingspan: [34, 43],
    mass: [70, 100],
    fact: 'The blue jay frequently mimics the calls of hawks, possibly to deceive other species into believing a hawk is present.',
  },
  {
    name: 'House Sparrow',
    species: 'Passer domesticus',
    imagePath: 'houseSparrow',
    speed: 0.2,
    rarity: 1,
    region: 'Widespread',
    habitat: 'Towns',
    wingspan: [19, 25],
    mass: [24, 39.5],
    fact: 'The house sparrow is a very social bird, engaging in "social singing" sessions, roosting communally, and forming flocks with other species of birds.',
  },
  {
    name: 'Indigo Bunting',
    species: 'Passerina cyanea',
    imagePath: 'indigoBunting',
    speed: 0.25,
    rarity: 1,
    region: 'Americas',
    habitat: 'Open Woodlands',
    wingspan: [18, 23],
    mass: [11.2, 21.4],
    fact: 'The male indigo bunting is vibrant blue in the summer, with brightly colored plumage during the breeding season to attract a mate, but brown in the winter.',
  },
  {
    name: 'Little Owl',
    species: 'Athene noctua',
    imagePath: 'littleOwl',
    speed: 0.25,
    rarity: 2,
    region: 'Europe, Asia & Africa',
    habitat: 'Open Woodlands',
    wingspan: [56],
    mass: [180],
    fact: 'Though most active at night, the little owl can be seen during the middle of the day, basking in the sun on an exposed perch such as a telegraph pole, dead tree or isolated building.',
    nocturnal: true,
  },
  {
    name: "Major Mitchell's Cockatoo",
    species: 'Lophochroa leadbeateri',
    imagePath: 'majorMitchellsCockatoo',
    speed: 0.3,
    rarity: 15,
    region: 'Australia',
    habitat: 'Tropical Dry Forests',
    wingspan: [81],
    mass: [300, 450],
    fact: "A hardy and bright bird, Major Mitchell's cockatoo boasts an impressive lifespan, with the oldest individual having lived 83 years.",
  },
  {
    name: 'Mourning Dove',
    species: 'Zenaida macroura',
    imagePath: 'mourningDove',
    speed: 0.4,
    rarity: 1,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [37, 45],
    mass: [112, 170],
    fact: 'A prolific breeder, the mourning dove may raise up to six broods of two young each in a single year.',
  },
  {
    name: 'Northern Cardinal',
    species: 'Cardinalis cardinalis',
    imagePath: 'northernCardinal',
    speed: 0.3,
    rarity: 2,
    region: 'Americas',
    habitat: 'Open Woodlands',
    wingspan: [25, 31],
    mass: [33.6, 65],
    fact: 'The northern cardinal is fiercely territorial, and will sometimes spend hours relentlessly attempting to fight its own reflection in a window.',
  },
  {
    name: 'Rainbow Lorikeet',
    species: 'Trichoglossus moluccanus',
    imagePath: 'rainbowLorikeet',
    speed: 0.3,
    rarity: 20,
    region: 'Australia',
    habitat: 'Rainforests',
    wingspan: [25, 30],
    mass: [75, 157],
    fact: 'The rainbow lorikeet is monogamous, and they are usually seen flying in pairs.',
  },
  {
    name: 'Release Dove',
    species: 'Columba livia domestica',
    imagePath: 'releaseDove',
    speed: 0.25,
    rarity: 4,
    region: 'Widespread',
    habitat: 'Domestic',
    wingspan: [62, 72],
    mass: [238, 380],
    fact: "The release dove's feathers are loosely attached to it's body, allowing for an easy escape if trapped by a predator.",
  },
  {
    name: 'Turkey',
    species: 'Meleagris gallopavo',
    imagePath: 'turkey',
    speed: 0.2,
    rarity: 12,
    region: 'N. America',
    habitat: 'Open Woodlands',
    wingspan: [125, 144],
    mass: [5000, 11000],
    fact: "The colors of the turkey's head change among red, blue, and white, depending on how excited or calm it is.",
  },
];

let usedBirdTypes = birdTypes;

// only spawn nocturnal birds at night
const currentHour = new Date().getHours();
if (currentHour > 7 && currentHour < 19) {
  usedBirdTypes = usedBirdTypes.filter(type => !type.nocturnal);
}

const getRarity = (birdType, birdsSeen) => {
  const SEEN_BIRD_RARITY_DECREASE = 50;
  let rarity = birdType.rarity;
  if (birdsSeen[birdType.imagePath]) {
    // if this bird has been seen before, significantly decrease its rarity
    rarity /= SEEN_BIRD_RARITY_DECREASE;
  }
  return rarity;
};

const getRarityTotal = birdsSeen => {
  let total = 0;
  for (const type of usedBirdTypes) {
    total += 1 / getRarity(type, birdsSeen);
  }
  return total;
};

export const randomBirdType = () => {
  return chrome.storage.local.get({ birdsSeen: {} }).then(({ birdsSeen }) => {
    const pick = Math.random() * getRarityTotal(birdsSeen);
    let raritySum = 0;
    for (const type of usedBirdTypes) {
      raritySum += 1 / getRarity(type, birdsSeen);
      if (pick < raritySum) {
        return type;
      }
    }
  });
};
